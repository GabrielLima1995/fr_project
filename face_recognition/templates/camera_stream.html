<!DOCTYPE html>
{% load static %}
<html>
<head>    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <style>
        body {
            width: 100vw;
            height: 100vh;
            background: linear-gradient(91.1deg, rgb(57, 31, 105) -2.3%, rgb(115, 43, 155) 44.4%, rgb(231, 75, 184) 103.4%);
        }
        
        .logo-img {
            height: 80px;
            transform: scale(0.8);
        }

        .search-img {
            transform: scale(0.6);
        }

        .logo-text {
            font-family: 'Ubuntu', sans-serif;
            font-size: 38px;
            font-weight: 100;
        }
        
        .logo-container {
            display: flex;
            background: rgba( 255, 255, 255, 0.2 );
            box-shadow: 0 8px 32px 0 rgba( 31, 38, 135, 0.37 );
            backdrop-filter: blur( 2px );
            border-radius: 50px;
            border: 1px solid rgba( 255, 255, 255, 0.18 );
            padding: 0px 10px 0px 10px;
        }

        .bar-container {
            margin: 20px 0px 20px 0px;
            width: 100%;
            display: flex;
            padding: 20px;
            justify-content: flex-start;
        }

        input, input#id_search_query {
            background: transparent;
            outline: none !important;
            border: none;
            border-bottom: 1px solid #ffffffab;
            color: white;
            font-weight: 100;
        }

        ::-webkit-input-placeholder {
            color: white;
         }
         
         :-moz-placeholder { 
            color: white;  
         }
         
         ::-moz-placeholder {  
            color: white;  
         }
         
         :-ms-input-placeholder {  
            color: white;  
         }

         .camera-container {
            padding-left: 25px;
            padding-right: 10px;
         }

         .camera {
            width: 100%;
            border-radius: 10px;
            border: 4px solid #ffffff21;
         }

         button {
            background: transparent;
            outline: none;
            border: 1px solid #e7cbe7;
            color: white;
            font-size: 15px;
            height: 35px;
            border-radius: 10px;
            position: relative;
            top: 6px;
            margin-left: 15px;
            margin-right: 10px;
         }

         form {
            width: 100%;
            display: flex;
            align-items: center;
         }

         .img-result {
            width: 90%;
            box-shadow: -1px 0px 10px 0px rgb(40 12 107 / 57%);
            border-radius: 10px;
         }

         .images-container {
            display: flex;
            overflow-x: auto;
         }

         .flex {
            display: flex;
         }

         .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
         }

         .glass-card {
            background: rgb(255 255 255 / 22%);
            box-shadow: 0 8px 32px 0 rgb(38 44 90 / 37%);
            backdrop-filter: blur( 4px );
            margin: 0px 12px 0px 0px;
            border-radius: 10px;
            height: 97%;
            min-height: 400px;
            border: 1px solid rgba( 255, 255, 255, 0.18 );
         } 

         ::-webkit-scrollbar {
            width: 20px;
          }
          
          /* Track */
          ::-webkit-scrollbar-track {
            border-radius: 10px;
            border: 1px solid #ffffff2e;
          }
          
          /* Handle */
          ::-webkit-scrollbar-thumb {
            background: rgb(255 255 255 / 70%);
            border-radius: 10px;
            width: 200px;
            border: 1px solid white;
          }

          p {
            width: 100%;
          }

          p > * {
            width: 100%;
          }

          input:-internal-autofill-selected {
            background-color: -internal-light-dark(transparent) !important;
          }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark" style="background-color: transparent;">
        
        <div class="bar-container col-12">
            <div class="logo-container logo-text col-5">
                <a href="/" class="flex-center navbar-brand">
                    <img src="{%static 'intelicity.png'%}" class="logo-img" alt="" width="100" height="100">
    
                    <span style="font-size: 38px;">Projeto de Segurança Pública</span>
                </a>
            </div>

            <div class=" logo-container logo-text col-7 custom-scroll" style="margin-left: 10px;">
      
                    <img src="{%static 'user-icon.png'%}" class="search-img" alt="" width="80" height="80">
    
                    <!--<input placeholder="Insira o nome"/>-->
                    <form id="form" method="post">
                        {% csrf_token %}
                        {{ form.as_p }}
                    <button id="botaoSubmit" type="submit" class="flex-center">    <img src="{%static 'search.png'%}" class="search-img" alt="" width="35" height="35"></button>
                    </form>
  
            </div>
        </div>
            
    </nav>
    <div class="col-12 flex">
    
        <div class="col-5 camera-container">
            <img class="camera" src="{% url 'stream' %}">
        </div>
         
        <div id="images-container" class="col-7 images-container">
            <!--<div class="flex col-8 glass-card flex-center">
                <img class="img-result" src="" alt="{{ image.name }}">
            </div>-->
        </div>

    </div>

    <script>
        const formulario = document.getElementById('form')
        const botaoFormulario = document.getElementById('botaoSubmit')
        const inputFormulario = document.getElementById('id_search_query')

        botaoFormulario.addEventListener('click', enviaDadosFormulario)
        
        formulario.addEventListener("submit", function(event) {
            event.preventDefault();
        });

        function enviaDadosFormulario() {
            if (formulario.checkValidity()) {
                axios.post('http://127.0.0.1:8000/search/', {name: inputFormulario.value})
                .then(response => {
                    const containerDeImagens = document.getElementById('images-container')
                    
                    while (containerDeImagens.firstChild) {
                        containerDeImagens.removeChild(containerDeImagens.firstChild);
                    }
                    imgList = response.data.images
                    console.log(imgList.length)
                    imgList.forEach(img => {
                        const novaDivImagem = document.createElement('div')
                        const imagem = document.createElement('img')
                        novaDivImagem.setAttribute('class', 'flex col-8 glass-card flex-center')
                        imagem.setAttribute('class', 'img-result')
                        imagem.setAttribute('src', img.url)
                        imagem.setAttribute('alt', img.name)
                        novaDivImagem.appendChild(imagem)
                        containerDeImagens.appendChild(novaDivImagem)
                    })
                })
                .catch(error => {
                    console.error(error);
                });
            }   
        }
    </script>
</body>
</html>